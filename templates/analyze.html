{% extends "template.html" %}
{% block title %}Analyze{% endblock title %}
{% block pageTitle %}Analysis{% endblock pageTitle %}
{% block navLink %}analyze{% endblock navLink %}

{% block body %}
  {{ super() }}
  <h5>Download Usage Guide <a href="https://docs.google.com/document/d/1owFsCKhDUvF7T9SCQJTIQ-c1gQV6KgiIxk-d9Ufn7o4/edit?usp=sharing">Here</a>.</h5>
  <form method="POST" action="" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.jsonFile.label(class="form-control-label") }}
        {% if form.jsonFile.errors %}
            {{ form.jsonFile(class="form-control is-invalid") }}
                {% for error in form.jsonFile.errors %}
                    <span class="invalid-feedback">{{ error }}</span>
                {% endfor %}
        {% else %}
            {{ form.jsonFile(class="form-control mb-3") }}
        {% endif %}
      
        {% if form.automatic.errors %}
            {{ form.automatic(class="form-control is-invalid") }}
                {% for error in form.automatic.errors %}
                    <span class="invalid-feedback">{{ error }}</span>
                {% endfor %}
            </div>
        {% else %}
            {{ form.automatic(class="form-check-input mb-3", type="checkbox", id="automatic") }}
        {% endif %}
        {{ form.automatic.label(class="form-check-label me-3") }}
      
        <div class="ms-5">
          <div id="automatic group">
            {{ form.maxResults.label(class="form-control-label") }}
            {% if form.maxResults.errors %}
                {{ form.maxResults(class="form-control is-invalid") }}
                    {% for error in form.maxResults.errors %}
                        <span class="invalid-feedback">{{ error }}</span>
                    {% endfor %}
            {% else %}
                {{ form.maxResults(class="form-control mb-3") }}
            {% endif %}
          </div>
          <div id="nonautomatic group">
            {{ form.unigramNum.label(class="form-control-label") }}
            {% if form.unigramNum.errors %}
                {{ form.unigramNum(class="form-control is-invalid") }}
                    {% for error in form.unigramNum.errors %}
                        <span class="invalid-feedback">{{ error }}</span>
                    {% endfor %}
            {% else %}
                {{ form.unigramNum(class="form-control mb-3") }}
            {% endif %}

            {{ form.bigramFreq.label(class="form-control-label") }}
            {% if form.bigramFreq.errors %}
                {{ form.bigramFreq(class="form-control is-invalid") }}
                    {% for error in form.bigramFreq.errors %}
                        <span class="invalid-feedback">{{ error }}</span>
                    {% endfor %}
            {% else %}
                {{ form.bigramFreq(class="form-control mb-3") }}
            {% endif %}

            {{ form.trigramFreq.label(class="form-control-label") }}
            {% if form.trigramFreq.errors %}
                {{ form.trigramFreq(class="form-control is-invalid") }}
                    {% for error in form.trigramFreq.errors %}
                        <span class="invalid-feedback">{{ error }}</span>
                    {% endfor %}
            {% else %}
                {{ form.trigramFreq(class="form-control mb-3") }}
            {% endif %}

            {{ form.quadgramFreq.label(class="form-control-label") }}
            {% if form.quadgramFreq.errors %}
                {{ form.quadgramFreq(class="form-control is-invalid") }}
                    {% for error in form.quadgramFreq.errors %}
                        <span class="invalid-feedback">{{ error }}</span>
                    {% endfor %}
            {% else %}
                {{ form.quadgramFreq(class="form-control mb-3") }}
            {% endif %}
          </div>
        </div>
    </div>
    {{ form.submit(class="btn btn-primary", onclick="loading()") }}
  </form>
{% endblock body %}

{% block results %}
{{ super() }}
{% if data != None %}
<div id="data">
  <h5 class="lead text-center">If any clues are not properly filtered, namely they are just parts of the standard Quizbowl canon, please submit them to this <a href="https://forms.gle/3iiSSbspPfuEDvTe7">form</a>.</h5>
  <h5 class="lead text-center mb-4">Copy any clue by simply clicking on the clue card!</h5>
  <div class="text-center">
  <h3>Unigrams Clues(a.k.a Buzzwords): </h3>
  {% if data[0] %}
  <div class="row g-4 text-center justify-content-center mb-4">
    {% for e in data[0] %}
    <div class="col-sm-2">
      <div class="card h-100" data-bs-toggle="tooltip" title="Copy!" data-bs-trigger="click" onclick="copyTooltip(this, '{{e}}')" onmouseleave="hideTooltip(this)">
        <div class="card-body">
          <p class="card-text">{{e}}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center">
  <button type="button" class="btn btn-primary mb-3 w-50" onclick="copyToClipboard(String.raw`{{data[4][0]}}`);">Copy Unigrams</button>
  </div>
  {% else %}
  <h5>No unigrams found!</h5>
  {% endif %}
  <h3 class="mt-3">Bigrams Clues(By PMI Score): </h3>
  {% if data[1] %}
  <div class="row g-4 text-center justify-content-center mb-4">
    {% for e in data[1] %}
    <div class="col-sm-2">
      <div class="card h-100" data-bs-toggle="tooltip" title="Copy!" data-bs-trigger="click" onclick="copyTooltip(this, '{{e}}')" onmouseleave="hideTooltip(this)">
        <div class="card-body">
          <p class="card-text">{{e}}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center">
  <button type="button" class="btn btn-primary mb-3 w-50" onclick="copyToClipboard(String.raw`{{data[4][1]}}`);">Copy Bigrams</button>
  </div>
  {% else %}
  <h5>No bigrams found!</h5>
  {% endif %}
  <h3 class="mt-3">Trigrams Clues(By PMI Score): </h3>
  {% if data[2] %}
  <div class="row g-4 text-center justify-content-center mb-4">
    {% for e in data[2] %}
    <div class="col-sm-2">
      <div class="card h-100" data-bs-toggle="tooltip" title="Copy!" data-bs-trigger="click" onclick="copyTooltip(this, '{{e}}')" onmouseleave="hideTooltip(this)">
        <div class="card-body">
          <p class="card-text">{{e}}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center">
  <button type="button" class="btn btn-primary mb-3 w-50" onclick="copyToClipboard(String.raw`{{data[4][2]}}`);">Copy Trigrams</button>
  </div>
  {% else %}
  <h5>No Trigrams found!</h5>
  {% endif %}
  <h3 class="mt-3">Quadgrams Clues(By PMI Score): </h3>
  {% if data[3] %}
  <div class="row g-4 text-center justify-content-center mb-4">
    {% for e in data[3] %}
    <div class="col-sm-2">
      <div class="card h-100" data-bs-toggle="tooltip" title="Copy!" data-bs-trigger="click" onclick="copyTooltip(this, '{{e}}')" onmouseleave="hideTooltip(this)">
        <div class="card-body">
          <p class="card-text">{{e}}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center">
  <button type="button" class="btn btn-primary mb-3 w-50" onclick="copyToClipboard(String.raw`{{data[4][3]}}`);">Copy Quadgrams</button>
  </div>
  {% else %}
  <h5>No quadgrams found!</h5>
  {% endif %}
  </div>
</div>
{% endif %}
{% endblock results %}

{% block script %}
  <script>
    const checkbox = document.getElementById('automatic');
    const automatic = document.getElementById('automatic group');
    const nonautomatic = document.getElementById('nonautomatic group');

    function updateForm() {
      if (checkbox.checked) {
        automatic.style.display = 'block';
        nonautomatic.style.display = 'none';
      } else {
        automatic.style.display = 'none';
        nonautomatic.style.display = 'block';
      }
    }
    updateForm();
    
    checkbox.addEventListener('click', updateForm);

    function loading() {
      const data = document.getElementById("data")
      if(data !== null){
        data.style.display = 'none';
      }
      const spinner = document.getElementById("loadSpinner");
      spinner.parentElement.style.display = 'block';
      spinner.style.display = 'block';
    }

    function copyTooltip(ele, message){
      copyToClipboard(String.raw`${message}`)
      ele.setAttribute("data-bs-original-title", "Copied!");
    }
    
    function hideTooltip(ele) {
      if(ele.getAttribute("data-bs-original-title") == "Copied!"){
        ele.click();
        ele.setAttribute("data-bs-original-title", "Copy!");
      }
    }
    
    {% if data != None %}
      const spinner = document.getElementById("loadSpinner");
      spinner.style.display = 'none';
      document.getElementById("scrollTo").scrollIntoView();
    {% endif %}
  </script>
{% endblock script %}